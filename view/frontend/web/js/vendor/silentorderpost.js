/**
 * Braspag Silent Order Post
 *
 * @author      Webjump Core Team <dev@webjump.com>
 * @copyright   2016 Webjump (http://www.webjump.com.br)
 * @license     http://www.webjump.com.br  Copyright
 *
 * @link        http://www.webjump.com.br
 */
function bpSop_silentOrderPost(e){bpsilentOptions=bpSop_mergeOptions(e,defaultOptions);var a=bpSop_validateData();a&&bpSop_sendRequestToApi()}function bpSop_sendRequestToApi(){var e=bpSop_getUrl(bpsilentOptions.environment),a=[];if(a.push("HolderName="+bpSop_getElementValue(".bp-sop-cardholdername")),a.push("RawNumber="+bpSop_getElementValue(".bp-sop-cardnumber")),a.push("Expiration="+bpSop_getElementValue(".bp-sop-cardexpirationdate")),bpsilentOptions.cvvrequired)/^([0-9]{3}|[0-9]{4})$/.test(unescape(bpSop_getElementValue(".bp-sop-cardcvv")))&&a.push("SecurityCode="+bpSop_getElementValue(".bp-sop-cardcvv"));else{var t=bpSop_getElementValue(".bp-sop-cardcvv");t&&/^(\s*|[0-9]{3}|[0-9]{4})$/.test(unescape(t))&&a.push("SecurityCode="+t)}a.push("AccessToken="+bpsilentOptions.accessToken);var n=a.join("&"),r=new XMLHttpRequest;"withCredentials"in r?(r.onreadystatechange=function(){if(4==r.readyState)if(201==r.status){var e=JSON.parse(r.responseText);bpsilentOptions.onSuccess(e)}else{var a={Code:r.status,Text:r.statusText};bpsilentOptions.onError(a)}},r.open("POST",e,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.setRequestHeader("Accept","application/json"),r.send(n)):window.XDomainRequest?(r=new window.XDomainRequest,r.timeout=3e3,r.open("POST",e),r.onload=function(){var e=JSON.parse(r.responseText);bpsilentOptions.onSuccess(e)},r.onerror=function(){var e={Code:"401",Text:"Unauthorized"};bpsilentOptions.onError(e)},r.send(n)):alert("Browser not supported!")}function bpSop_mergeOptions(e,a){var t={};for(var n in a)a.hasOwnProperty(n)&&(t[n]=a[n]);for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function bpSop_getUrl(e){switch(e){case"dev":return"https://dev.pagador.com.br/post/api/public/v1/card";case"sandbox":return"https://homologacao.pagador.com.br/post/api/public/v1/card";case"production":default:return"https://www.pagador.com.br/post/api/public/v1/card"}}function bpSop_validateMandatoryValue(e){if(!e)return!1;var a=unescape(e);return bpSop_CustomTrim(a)?!0:!1}function bpSop_validateData(){var e=[],a=!1,t=!1;bpSop_validateMandatoryValue(bpsilentOptions.accessToken)||(t=!0,e.push({Field:"AccessToken",Message:validationMessages.missingAccessToken()}),a=!0),/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(bpsilentOptions.accessToken)||t||(e.push({Field:"AccessToken",Message:validationMessages.invalidFormat()}),a=!0);var n=!1;bpSop_validateMandatoryValue(unescape(bpSop_getElementValue(".bp-sop-cardholdername")))||(n=!0,e.push({Field:"bp-sop-cardholdername",Message:validationMessages.mandatory()}),a=!0),/^[a-zA-Z ]{1,64}$/.test(unescape(bpSop_getElementValue(".bp-sop-cardholdername")))||n||(e.push({Field:"bp-sop-cardholdername",Message:validationMessages.holderFormat()}),a=!0);var r=!1;bpSop_validateMandatoryValue(unescape(bpSop_getElementValue(".bp-sop-cardnumber")))||(r=!0,e.push({Field:"bp-sop-cardnumber",Message:validationMessages.mandatory()}),a=!0),/^[0-9]{1,19}$/.test(unescape(bpSop_getElementValue(".bp-sop-cardnumber")))||r||(r=!0,e.push({Field:"bp-sop-cardnumber",Message:validationMessages.numberFormat()}),a=!0),bpSop_validateCardFormat(unescape(bpSop_getElementValue(".bp-sop-cardnumber")))||r||(e.push({Field:"bp-sop-cardnumber",Message:validationMessages.numberValidity()}),a=!0);var s=!1;if(bpSop_validateMandatoryValue(unescape(bpSop_getElementValue(".bp-sop-cardexpirationdate")))||(s=!0,e.push({Field:"bp-sop-cardexpirationdate",Message:validationMessages.mandatory()}),a=!0),/^(0[1-9]|1[0-2])\/([0-9]{4})$/.test(unescape(bpSop_getElementValue(".bp-sop-cardexpirationdate")))||s||(e.push({Field:"bp-sop-cardexpirationdate",Message:validationMessages.expirationFormat()}),a=!0),bpsilentOptions.cvvrequired)/^([0-9]{3}|[0-9]{4})$/.test(unescape(bpSop_getElementValue(".bp-sop-cardcvv")))||(e.push({Field:"bp-sop-cardcvv",Message:validationMessages.securityCodeFormat()}),a=!0);else{var o=bpSop_getElementValue(".bp-sop-cardcvv");o&&(/^(\s*|[0-9]{3}|[0-9]{4})$/.test(unescape(o))||(e.push({Field:"bp-sop-cardcvv",Message:validationMessages.securityCodeFormat()}),a=!0))}return a?(bpsilentOptions.onInvalid(e),!1):!0}function bpSop_validateCardFormat(e){var a=unescape(e),t=parseInt(a.substring(a.length-1,a.length)),n=a.substring(0,a.length-1);return bpSop_calculateMod10(n)!=parseInt(t)?!1:!0}function bpSop_calculateMod10(e){for(var a=0,t=0;t<e.length;t++)a+=parseInt(e.substring(t,t+1));var n=new Array(0,1,2,3,4,-4,-3,-2,-1,0);for(t=e.length-1;t>=0;t-=2){var r=parseInt(e.substring(t,t+1)),s=n[r];a+=s}var o=a%10;return o=10-o,10==o&&(o=0),o}function bpSop_getElement(e){var a=document.querySelectorAll(e);return a&&a.length>0?a[0]:null}function bpSop_getElementValue(e){var a=bpSop_getElement(e);return a?"INPUT"==a.nodeName?encodeURIComponent(a.value):encodeURIComponent(a.innerText):null}function bpSop_CustomTrim(e){try{return e.trim()}catch(a){for(var t=0;t<e.length&&" "==e[t];)t++;return e.substring(t,e.length)}}var bpsilentOptions={},defaultOptions={environment:"undefined",onSuccess:function(){},onError:function(){},onInvalid:function(){},language:"PT",cvvrequired:!0},validationMessages={missingAccessToken:function(){switch(bpsilentOptions.language){case"EN":return"missing";case"ES":return"ausente";default:return"ausente"}},invalidFormat:function(){switch(bpsilentOptions.language){case"EN":return"invalid format";case"ES":return"formato inválido";default:return"formato inválido"}},mandatory:function(){switch(bpsilentOptions.language){case"EN":return"is mandatory";case"ES":return"es obligatorio";default:return"é obrigatório"}},holderFormat:function(){switch(bpsilentOptions.language){case"EN":return"should contain a maximum of 64 alphanumeric characters";case"ES":return"debe contener un máximo de 64 caracteres alfanuméricos";default:return"deve conter no máximo 64 caracteres alfanuméricos"}},numberFormat:function(){switch(bpsilentOptions.language){case"EN":return"should contain a maximum of 19 numeric characters";case"ES":return"debe contener un máximo de 19 caracteres numéricos";default:return"deve conter no máximo 64 caracteres alfanuméricos"}},numberValidity:function(){switch(bpsilentOptions.language){case"EN":return"must contain a valid card number";case"ES":return"debe contener un número de tarjeta válida";default:return"deve conter um número de cartão válido"}},expirationFormat:function(){switch(bpsilentOptions.language){case"EN":return"must be valid and respect the format MM/yyyy";case"ES":return"debe ser válido y respetar el formato MM/aaaa";default:return"deve ser válido e respeitar o formato MM/aaaa"}},securityCodeFormat:function(){switch(bpsilentOptions.language){case"EN":return"must contain 3 or 4 numeric characters";case"ES":return"debe contener 3 o 4 caracteres numéricos";default:return"deve conter 3 ou 4 caracteres numéricos"}}};